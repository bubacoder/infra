version: '3'

tasks:
  build:
    internal: true
    cmds:
      - |
        cd ansible
        docker build --platform linux/amd64 -t infra-devcontainer:{{.TAG}} -f ../.devcontainer/Dockerfile --build-arg BASE_IMAGE={{.BASE_IMAGE}} --progress=plain .

  build-debian:
    desc: Build Debian Bookworm based admin-/devcontainer
    cmds:
      - task: build
        vars:
          BASE_IMAGE: "debian:bookworm-slim"
          TAG: debian

  build-ubuntu:
    desc: Build Ubuntu 24.04 LTS based admin-/devcontainer
    cmds:
      - task: build
        vars:
          BASE_IMAGE: "ubuntu:24.04"
          TAG: ubuntu

  build-all:
    desc: Build Debian and Ubuntu based admin-/devcontainers
    cmds:
      - task: build-debian
      - task: build-ubuntu
      - docker images {{.CONTAINER_NAME}}

  run-debian:
    desc: Run Debian Bookworm based admin-/devcontainer
    cmds:
      - docker run -it infra-devcontainer:debian

  run-ubuntu:
    desc: Run Ubuntu 24.04 LTS based admin-/devcontainer
    cmds:
      - docker run -it infra-devcontainer:ubuntu
